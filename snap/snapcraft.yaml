name: lomiri-ui-toolkit-core24
version: "latest"
summary: A convergent UI toolkit for all formfactors
description: |
  Lomiri is the continuation of the Unity8 effors by Canonical Ltd.
compression: lzo
grade: stable
confinement: strict
base: core24

platforms:
  amd64:
    build-on: amd64
  arm64:
    build-on: arm64
  armhf:
    build-on: armhf

slots:
  lomiri-ui-toolkit:
    content: lomiri-ui-toolkit
    interface: content
    read:
      - $SNAP

plugs:
  graphics-core24:
    interface: content
    target: $SNAP/graphics
    default-provider: mesa-2404

parts:
  suru-icons:
    plugin: nil
    source: https://gitlab.com/ubports/core/suru-icon-theme.git
    source-branch: main
    override-build: |
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/share/icons
      cp -a $SNAPCRAFT_PART_SRC/suru $SNAPCRAFT_PART_INSTALL/usr/share/icons/
  lomiri-ui-toolkit:
    plugin: qmake
    after: [ suru-icons ]
    qmake-project-file: lomiri-sdk.pro
    qmake-parameters:
        - CONFIG+=ubuntu-uitk-compat
        - CONFIG+=no_docs
        - CONFIG+=debian_build
    source: https://gitlab.com/ubports/core/lomiri-ui-toolkit.git
    source-branch: main
    override-build: |
      rm -rf $SNAPCRAFT_PART_SRC/examples || true
      sed -i "s/ po app-launch-profiler / /g" $SNAPCRAFT_PART_SRC/lomiri-sdk.pro
      sed -i "s/^src_uitk_launcher\./#src_uitk_launcher\./g" $SNAPCRAFT_PART_SRC/lomiri-sdk.pro
      sed -i "s/ src_uitk_launcher apicheck/ /g" $SNAPCRAFT_PART_SRC/lomiri-sdk.pro
      craftctl default
    build-packages:
        - dbus
        - dbus-test-runner
        - devscripts
        - gdb
        - libdbus-1-dev
        - liblttng-ust-dev
        - libqt5svg5-dev
        - libxi-dev
        - qtbase5-private-dev
        - qtdeclarative5-private-dev
        - qml-module-qtfeedback
        - qml-module-qtquick2
        - qml-module-qtquick-window2
        - qml-module-qtquick-layouts
        - qml-module-qtgraphicaleffects
        - qml-module-qttest
        - qml-module-qtfeedback
        - qtsystems5-dev
        - qtsystems5-private-dev
        - qtpim5-dev
    stage-packages:
        - fonts-ubuntu
        - yaru-theme-icon
        - libbluetooth3
        - liblttng-ust1
        - libnuma1
        - liburcu8
        - libdouble-conversion3
        - libegl1
        - libevdev2
        - libfreetype6
        - libgl1
        - libglvnd0
        - libglx0
        - libgraphite2-3
        - libharfbuzz0b
        - libicu74
        - libpcre2-16-0
        - libpng16-16
        - libqt5core5a
        - libqt5dbus5
        - libqt5gui5
        - libqt5network5
        - libqt5qml5
        - libqt5quick5
        - libqt5test5
        - libqt5widgets5
        - libqt5organizer5a
        - libqt5systeminfo5
        - libx11-6
        - libxau6
        - libxcb1
        - libxdmcp6
        - libxext6
        - libxi6
        - qml-module-qtfeedback
        - qml-module-qtgraphicaleffects
        - qml-module-qtqml-models2
        - qml-module-qtquick-layouts
        - qml-module-qtquick-localstorage
        - qml-module-qtquick-window2
        - qml-module-qtquick2
        - qml-module-qtquick-controls2
        - qml-module-qtquick-templates2
        - libqt5quickcontrols2-5
        - libqt5quicktemplates2-5

  quickcontrolssuru:
    plugin: qmake
    source: https://gitlab.com/ubports/development/core/qqc2-suru-style.git
    source-branch: main
    qmake-project-file: suru.pro
    build-packages:
        - qtquickcontrols2-5-dev
        - qtquickcontrols2-5-private-dev
        - qtdeclarative5-dev
        - qtdeclarative5-private-dev
        - qtdeclarative5-dev-tools
        - qtbase5-dev
        - qtbase5-private-dev
        - qt5-qmake
        - pkg-kde-tools
    after: [ lomiri-ui-toolkit ]

  qt-setup:
    after: [ quickcontrolssuru ]
    source: https://github.com/snapcore/snapcraft-desktop-integration.git
    plugin: nil
    override-build: |
      cd qt-framework
      make PLATFORM_PLUG=desktop DESTDIR=$SNAPCRAFT_PART_INSTALL install
    stage:
      - command-chain
  wrappers:
    after: [ qt-setup ]
    source: snap/local
    plugin: dump
